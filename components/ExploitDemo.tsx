'use client'

import { useState } from 'react'

type AttackStep = {
  id: number
  title: string
  description: string
  codeSnippet?: string
  result?: string
}

export default function ExploitDemo() {
  const [currentStep, setCurrentStep] = useState(0)
  const [isAttacking, setIsAttacking] = useState(false)

  const steps: AttackStep[] = [
    {
      id: 0,
      title: 'è„†å¼±æ€§ã‚’ç™ºè¦‹',
      description: 'Webã‚¢ãƒ—ãƒªã«ã€ŒSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€ã®è„†å¼±æ€§ã‚’ç™ºè¦‹ã€‚',
      codeSnippet: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ç›´æ¥SQLã‚¯ã‚¨ãƒªã«æŒ¿å…¥ã—ã¦ã„ã‚‹...',
    },
    {
      id: 1,
      title: 'ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ',
      description: 'è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹æ”»æ’ƒã‚³ãƒ¼ãƒ‰ã‚’æº–å‚™ã€‚',
      codeSnippet: "' OR '1'='1' --",
    },
    {
      id: 2,
      title: 'æ”»æ’ƒã‚’å®Ÿè¡Œ',
      description: 'ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’ã‚·ã‚¹ãƒ†ãƒ ã«é€ä¿¡ã€‚',
      result: 'âš ï¸ èªè¨¼ã‚’çªç ´ï¼ç®¡ç†è€…æ¨©é™ã‚’å–å¾—ã—ã¾ã—ãŸ',
    },
    {
      id: 3,
      title: 'ä¾µå…¥æˆåŠŸ',
      description: 'ã‚·ã‚¹ãƒ†ãƒ ã«ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æˆåŠŸã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±ã‚’çªƒå–ã€‚',
      result: 'âŒ å€‹äººæƒ…å ±10,000ä»¶ãŒæµå‡º',
    },
  ]

  const handleNextStep = () => {
    if (currentStep < steps.length - 1) {
      if (currentStep === 1) {
        setIsAttacking(true)
        setTimeout(() => {
          setIsAttacking(false)
          setCurrentStep(currentStep + 1)
        }, 1500)
      } else {
        setCurrentStep(currentStep + 1)
      }
    }
  }

  const handleReset = () => {
    setCurrentStep(0)
    setIsAttacking(false)
  }

  return (
    <div className="demo-section" style={{ marginTop: '20px' }}>
      <div style={{
        backgroundColor: '#f9f9f9',
        padding: '15px',
        borderRadius: '10px',
        border: '2px solid #ddd',
        marginBottom: '20px'
      }}>
        <h3 style={{ marginTop: 0, marginBottom: '12px', fontSize: '18px', fontWeight: 'bold', color: '#333' }}>
          ğŸ® ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã®æ”»æ’ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        </h3>

        <div style={{ marginBottom: '15px' }}>
          {steps.map((step, index) => {
            const isActive = index === currentStep
            const isCompleted = index < currentStep
            const isPending = index > currentStep

            return (
              <div
                key={step.id}
                style={{
                  marginBottom: '10px',
                  padding: '12px',
                  borderRadius: '8px',
                  border: `2px solid ${isActive ? '#ea9b8a' : '#ddd'}`,
                  backgroundColor: isActive ? '#ea9b8a20' : isCompleted ? '#f5f5f5' : '#fff',
                  opacity: isPending ? 0.5 : 1,
                  transition: 'all 0.3s ease',
                }}
              >
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '6px' }}>
                  <span style={{ fontSize: '20px', marginRight: '8px' }}>
                    {isCompleted ? 'âœ“' : isActive ? 'âš¡' : 'ğŸ”’'}
                  </span>
                  <h4 style={{
                    margin: 0,
                    color: isActive ? '#ea9b8a' : '#222',
                    fontWeight: isActive ? 'bold' : '600',
                    fontSize: '16px'
                  }}>
                    {step.title}
                  </h4>
                </div>
                <p style={{
                  margin: 0,
                  marginBottom: step.codeSnippet ? '8px' : 0,
                  color: '#555',
                  fontSize: '14px',
                  lineHeight: '1.6'
                }}>
                  {step.description}
                </p>
                {step.codeSnippet && isActive && (
                  <div style={{
                    backgroundColor: '#2d2d2d',
                    color: '#f8f8f2',
                    padding: '10px',
                    borderRadius: '5px',
                    fontFamily: 'monospace',
                    fontSize: '13px',
                    marginBottom: step.result ? '8px' : 0,
                  }}>
                    {step.codeSnippet}
                  </div>
                )}
                {step.result && isActive && (
                  <div style={{
                    backgroundColor: '#fff3cd',
                    border: '2px solid #ffc107',
                    padding: '10px',
                    borderRadius: '5px',
                    fontSize: '14px',
                    fontWeight: 'bold',
                    color: '#856404',
                  }}>
                    {step.result}
                  </div>
                )}
              </div>
            )
          })}
        </div>

        {isAttacking && (
          <div style={{
            padding: '12px',
            backgroundColor: '#f8d7da',
            border: '2px solid #dc3545',
            borderRadius: '8px',
            marginBottom: '12px',
            textAlign: 'center'
          }}>
            <p style={{ margin: 0, fontSize: '15px', fontWeight: 'bold', color: '#721c24' }}>
              âš¡ ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆå®Ÿè¡Œä¸­...
            </p>
          </div>
        )}

        <div style={{ display: 'flex', gap: '8px', justifyContent: 'center' }}>
          <button
            onClick={handleNextStep}
            disabled={currentStep >= steps.length - 1 || isAttacking}
            style={{
              backgroundColor: currentStep >= steps.length - 1 ? '#ccc' : '#ea9b8a',
              color: 'white',
              padding: '8px 16px',
              border: 'none',
              borderRadius: '5px',
              cursor: currentStep >= steps.length - 1 || isAttacking ? 'not-allowed' : 'pointer',
              fontSize: '14px',
              fontWeight: 'bold'
            }}
          >
            {currentStep >= steps.length - 1 ? 'å®Œäº†' : 'æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—'}
          </button>
          <button
            onClick={handleReset}
            style={{
              backgroundColor: '#6c757d',
              color: 'white',
              padding: '8px 16px',
              border: 'none',
              borderRadius: '5px',
              cursor: 'pointer',
              fontSize: '14px',
              fontWeight: 'bold'
            }}
          >
            ãƒªã‚»ãƒƒãƒˆ
          </button>
        </div>
      </div>
    </div>
  )
}
